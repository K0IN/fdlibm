#include "testconfig.h"
#define TEST_FUNC_F_L __MATH_PRECNAME(lround)
#include "testdriver.h"


static test_f_l_data const lround_data[] = {
	{ __LINE__, QNAN_P, LONG_MIN, FLAG_FAIL_SOFTFLOAT },
	{ __LINE__, QNAN_M, LONG_MIN, 0 },
	{ __LINE__, SNAN_P, LONG_MIN, FLAG_FAIL_SOFTFLOAT },
	{ __LINE__, SNAN_M, LONG_MIN, 0 },
	{ __LINE__, INF_P, LONG_MIN, FLAG_FAIL_SOFTFLOAT|FLAG_XFAIL },
	{ __LINE__, INF_M, LONG_MIN, FLAG_FAIL_SOFTFLOAT|FLAG_XFAIL },
	{ __LINE__, ZERO_P, 0, 0 },
	{ __LINE__, ZERO_M, 0, 0 },
	{ __LINE__, SUBNORM_P, 0, FLAG_SUBNORM },
	{ __LINE__, SUBNORM_M, 0, FLAG_SUBNORM },
	{ __LINE__, MIN_P, 0, 0 },
	{ __LINE__, MIN_M, 0, 0 },
	{ __LINE__, MAX_P, LONG_MIN, 0 },
	{ __LINE__, MAX_M, LONG_MIN, 0 },

	{ __LINE__, HEXCONSTE(4.5, 0x4001, 0x90000000L, 0x00000000L), 5, 0 },
	{ __LINE__, HEXCONSTE(3.5, 0x4000, 0xe0000000L, 0x00000000L), 4, 0 },
	{ __LINE__, HEXCONSTE(2.5, 0x4000, 0xa0000000L, 0x00000000L), 3, 0 },
	{ __LINE__, HEXCONSTE(2.0, 0x4000, 0x80000000L, 0x00000000L), 2, 0 },
	{ __LINE__, HEXCONSTE(1.5, 0x3fff, 0xc0000000L, 0x00000000L), 2, 0 },
	{ __LINE__, HEXCONSTE(1.0, 0x3fff, 0x80000000L, 0x00000000L), 1, 0 },
	{ __LINE__, HEXCONSTE(0.5, 0x3ffe, 0x80000000L, 0x00000000L), 1, 0 },
	{ __LINE__, HEXCONSTE(-0.5, 0xbffe, 0x80000000L, 0x00000000L), -1, 0 },
	{ __LINE__, HEXCONSTE(-1.0, 0xbfff, 0x80000000L, 0x00000000L), -1, 0 },
	{ __LINE__, HEXCONSTE(-1.5, 0xbfff, 0xc0000000L, 0x00000000L), -2, 0 },
	{ __LINE__, HEXCONSTE(-2.0, 0xc000, 0x80000000L, 0x00000000L), -2, 0 },
	{ __LINE__, HEXCONSTE(-2.5, 0xc000, 0xa0000000L, 0x00000000L), -3, 0 },
	{ __LINE__, HEXCONSTE(-3.5, 0xc000, 0xe0000000L, 0x00000000L), -4, 0 },
	{ __LINE__, HEXCONSTE(-4.5, 0xc001, 0x90000000L, 0x00000000L), -5, 0 },
	{ __LINE__, HEXCONSTE(0.1, 0x3ffb, 0xccccccccL, 0xcccccccdL), 0, 0 },
	{ __LINE__, HEXCONSTE(0.25, 0x3ffd, 0x80000000L, 0x00000000L), 0, 0 },
	{ __LINE__, HEXCONSTE(0.625, 0x3ffe, 0xa0000000L, 0x00000000L), 1, 0 },
	{ __LINE__, HEXCONSTE(-0.1, 0xbffb, 0xccccccccL, 0xcccccccdL), 0, 0 },
	{ __LINE__, HEXCONSTE(-0.25, 0xbffd, 0x80000000L, 0x00000000L), 0, 0 },
	{ __LINE__, HEXCONSTE(-0.625, 0xbffe, 0xa0000000L, 0x00000000L), -1, 0 },
	{ __LINE__, HEXCONSTE(22514.5, 0x400d, 0xafe50000L, 0x00000000L), 22515, 0 },
	{ __LINE__, HEXCONSTE(-22514.5, 0xc00d, 0xafe50000L, 0x00000000L), -22515, 0 },
	{ __LINE__, HEXCONSTE(262144.75, 0x4011, 0x80001800L, 0x00000000L), 262145L, 0 },
	{ __LINE__, HEXCONSTE(262142.75, 0x4010, 0xffffb000L, 0x00000000L), 262143L, 0 },
	{ __LINE__, HEXCONSTE(524286.75, 0x4011, 0xffffd800L, 0x00000000L), 524287L, 0 },
	{ __LINE__, HEXCONSTE(524288.75, 0x4012, 0x80000c00L, 0x00000000L), 524289L, 0 },
	{ __LINE__, HEXCONSTE(1048576.75, 0x4013, 0x80000600L, 0x00000000L), 1048577L, 0 },
	{ __LINE__, HEXCONSTE(1071930.0008, 0x4013, 0x82d9d001L, 0xa36e2eb2L), 1071930L, 0 },
	{ __LINE__, HEXCONSTE(2097152.75, 0x4014, 0x80000300L, 0x00000000L), 2097153L, 0 },
	{ __LINE__, HEXCONSTE(2492472.75, 0x4014, 0x9820e300L, 0x00000000L), 2492473L, 0 },
	{ __LINE__, HEXCONSTE(2886220.75, 0x4014, 0xb0293300L, 0x00000000L), 2886221L, 0 },
	{ __LINE__, HEXCONSTE(3058792.75, 0x4014, 0xbab1a300L, 0x00000000L), 3058793L, 0 },
	{ __LINE__, HEXCONSTE(-1048576.75, 0xc013, 0x80000600L, 0x00000000L), -1048577L, 0 },
	{ __LINE__, HEXCONSTE(-2097152.75, 0xc014, 0x80000300L, 0x00000000L), -2097153L, 0 },
	{ __LINE__, HEXCONSTE(-2492472.75, 0xc014, 0x9820e300L, 0x00000000L), -2492473L, 0 },
	{ __LINE__, HEXCONSTE(-2886220.75, 0xc014, 0xb0293300L, 0x00000000L), -2886221L, 0 },
	{ __LINE__, HEXCONSTE(-3058792.75, 0xc014, 0xbab1a300L, 0x00000000L), -3058793L, 0 },
	{ __LINE__, HEXCONSTE(1073741824.01, 0x401d, 0x80000000L, 0x051eb852L), 1073741824L, 0 },

	{ __LINE__, HEXCONSTE(8.38860800000000000000e+06, 0x4016, 0x80000000L, 0x00000000L), 8388608L, 0 },
	{ __LINE__, HEXCONSTE(1.67772160000000000000e+07, 0x4017, 0x80000000L, 0x00000000L), 16777216L, 0 },
	{ __LINE__, HEXCONSTE(3.35544320000000000000e+07, 0x4018, 0x80000000L, 0x00000000L), 33554432L, 0 },
	{ __LINE__, HEXCONSTE(-8.38860800000000000000e+06, 0xc016, 0x80000000L, 0x00000000L), -8388608L, 0 },
	{ __LINE__, HEXCONSTE(-1.67772160000000000000e+07, 0xc017, 0x80000000L, 0x00000000L), -16777216L, 0 },
	{ __LINE__, HEXCONSTE(-3.35544320000000000000e+07, 0xc018, 0x80000000L, 0x00000000L), -33554432L, 0 },

#if LONG_MAX > 2147483647L
	{ __LINE__, HEXCONSTE(70368744177664.75, 0x402d, 0x80000000L, 0x00018000L), 70368744177665L, 0 },
	{ __LINE__, HEXCONSTE(140737488355328.75, 0x402e, 0x80000000L, 0x0000c000L), 140737488355329L, 0 },
	{ __LINE__, HEXCONSTE(281474976710656.75, 0x402f, 0x80000000L, 0x00006000L), 281474976710657L, 0 },
	{ __LINE__, HEXCONSTE(562949953421312.75, 0x4030, 0x80000000L, 0x00003000L), 562949953421313L, 0 },
	{ __LINE__, HEXCONSTE(1125899906842624.75, 0x4031, 0x80000000L, 0x00001800L), 1125899906842625L, 0 },
	{ __LINE__, HEXCONSTE(-70368744177664.75, 0xc02d, 0x80000000L, 0x00018000L), -70368744177665L, 0 },
	{ __LINE__, HEXCONSTE(-140737488355328.75, 0xc02e, 0x80000000L, 0x0000c000L), -140737488355329L, 0 },
	{ __LINE__, HEXCONSTE(-281474976710656.75, 0xc02f, 0x80000000L, 0x00006000L), -281474976710657L, 0 },
	{ __LINE__, HEXCONSTE(-562949953421312.75, 0xc030, 0x80000000L, 0x00003000L), -562949953421313L, 0 },
	{ __LINE__, HEXCONSTE(-1125899906842624.75, 0xc031, 0x80000000L, 0x00001800L), -1125899906842625L, 0 },

	{ __LINE__, HEXCONSTE(4.50359962737049600000e+15, 0x4033, 0x80000000L, 0x00000000L), 4503599627370496L, 0 },
	{ __LINE__, HEXCONSTE(9.00719925474099200000e+15, 0x4034, 0x80000000L, 0x00000000L), 9007199254740992L, 0 },
	{ __LINE__, HEXCONSTE(1.80143985094819840000e+16, 0x4035, 0x80000000L, 0x00000000L), 18014398509481984L, 0 },
	{ __LINE__, HEXCONSTE(-4.50359962737049600000e+15, 0xc033, 0x80000000L, 0x00000000L), -4503599627370496L, 0 },
	{ __LINE__, HEXCONSTE(-9.00719925474099200000e+15, 0xc034, 0x80000000L, 0x00000000L), -9007199254740992L, 0 },
	{ __LINE__, HEXCONSTE(-1.80143985094819840000e+16, 0xc035, 0x80000000L, 0x00000000L), -18014398509481984, 0 },

	{ __LINE__, HEXCONSTE(281474976710656.025, 0x402f, 0x80000000L, 0x00000333L), 281474976710656L, 0 },
	{ __LINE__, HEXCONSTE(18014398509481974, 0x4034, 0xffffffffL, 0xffffd800L), 18014398509481974L, 0 },
#endif

	{ __LINE__, HEXCONSTE(0.2, 0x3ffc, 0xccccccccL, 0xcccccccdL), 0, 0 },
	{ __LINE__, HEXCONSTE(-0.2, 0xbffc, 0xccccccccL, 0xcccccccdL), 0, 0 },
	{ __LINE__, HEXCONSTE(0.5, 0x3ffe, 0x80000000L, 0x00000000L), 1, 0 },
	{ __LINE__, HEXCONSTE(-0.5, 0xbffe, 0x80000000L, 0x00000000L), -1, 0 },
	{ __LINE__, HEXCONSTE(0.8, 0x3ffe, 0xccccccccL, 0xcccccccdL), 1, 0 },
	{ __LINE__, HEXCONSTE(-0.8, 0xbffe, 0xccccccccL, 0xcccccccdL), -1, 0 },
	{ __LINE__, HEXCONSTE(1.5, 0x3fff, 0xc0000000L, 0x00000000L), 2, 0 },
	{ __LINE__, HEXCONSTE(-1.5, 0xbfff, 0xc0000000L, 0x00000000L), -2, 0 },
	{ __LINE__, HEXCONSTE(0.1, 0x3ffb, 0xccccccccL, 0xcccccccdL), 0, 0 },
	{ __LINE__, HEXCONSTE(0.25, 0x3ffd, 0x80000000L, 0x00000000L), 0, 0 },
	{ __LINE__, HEXCONSTE(0.625, 0x3ffe, 0xa0000000L, 0x00000000L), 1, 0 },
	{ __LINE__, HEXCONSTE(-0.1, 0xbffb, 0xccccccccL, 0xcccccccdL), 0, 0 },
	{ __LINE__, HEXCONSTE(-0.25, 0xbffd, 0x80000000L, 0x00000000L), 0, 0 },
	{ __LINE__, HEXCONSTE(-0.625, 0xbffe, 0xa0000000L, 0x00000000L), -1, 0 },
#if defined(TEST_LDOUBLE) && LDBL_MANT_DIG >= 64
	{ __LINE__, HEXCONSTE(2097152.5, 0x4014, 0x80000200L, 0x00000000L), 2097153L, 0 },
	{ __LINE__, HEXCONSTE(-2097152.5, 0xc014, 0x80000200L, 0x00000000L), -2097153L, 0 },
#endif

	{ __LINE__, HEXCONSTE(-4.45015e-308, 0xbc02, 0x8000044dL, 0xb01f4deeL), 0, 0 },
};


int main(int argc, char **argv)
{
	int status;
	
	status = 0;
	
	test_init(argc, argv);
	
	status |= test_table_f_l(lround_data, ARRAY_SIZE(lround_data), __FILE__);
	(void)check_fp;

	return status ? EXIT_FAILURE : EXIT_SUCCESS;
}
