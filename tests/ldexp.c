#include "testconfig.h"
#define TEST_FUNC_FI_F __MATH_PRECNAME(ldexp)
#include "testdriver.h"



static test_fi_f_data const ldexp_data[] = {
	{ __LINE__, ZERO_P, 0, ZERO_P, NO_INEXACT_EXCEPTION },
	{ __LINE__, ZERO_M, 0, ZERO_M, NO_INEXACT_EXCEPTION|FLAG_FAIL_ARANYM2 },

	{ __LINE__, INF_P, 1, INF_P, NO_INEXACT_EXCEPTION|FLAG_FAIL_ARANYM }, /* glibc returns NaN */
	{ __LINE__, INF_M, 1, INF_M, NO_INEXACT_EXCEPTION|FLAG_FAIL_ARANYM }, /* glibc returns NaN */
	{ __LINE__, QNAN_P, 1, QNAN_P, NO_INEXACT_EXCEPTION },

	{ __LINE__, QNAN_P, 1, QNAN_P, NO_INEXACT_EXCEPTION },
	{ __LINE__, QNAN_M, 1, QNAN_P, NO_INEXACT_EXCEPTION },
	{ __LINE__, SNAN_P, 1, QNAN_P, NO_INEXACT_EXCEPTION },
	{ __LINE__, SNAN_M, 1, QNAN_P, NO_INEXACT_EXCEPTION },

	{ __LINE__, HEXCONSTE(0.000000e+00, 0x0000, 0x00000000L, 0x00000000L), 0, HEXCONSTE(0.000000e+00, 0x0000, 0x00000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(5.000000e-01, 0x3ffe, 0x80000000L, 0x00000000L), 1, HEXCONSTE(1.000000e+00, 0x3fff, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(5.000000e-01, 0x3ffe, 0x80000000L, 0x00000000L), 2, HEXCONSTE(2.000000e+00, 0x4000, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(5.000000e-01, 0x3ffe, 0x80000000L, 0x00000000L), 3, HEXCONSTE(4.000000e+00, 0x4001, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(5.000000e-01, 0x3ffe, 0x80000000L, 0x00000000L), 4, HEXCONSTE(8.000000e+00, 0x4002, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(5.000000e-01, 0x3ffe, 0x80000000L, 0x00000000L), 9, HEXCONSTE(2.560000e+02, 0x4007, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(5.000000e-01, 0x3ffe, 0x80000000L, 0x00000000L), 16, HEXCONSTE(3.276800e+04, 0x400e, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(-5.000000e-01, 0xbffe, 0x80000000L, 0x00000000L), 1, HEXCONSTE(-1.000000e+00, 0xbfff, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(-5.000000e-01, 0xbffe, 0x80000000L, 0x00000000L), 2, HEXCONSTE(-2.000000e+00, 0xc000, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(-5.000000e-01, 0xbffe, 0x80000000L, 0x00000000L), 3, HEXCONSTE(-4.000000e+00, 0xc001, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(-5.000000e-01, 0xbffe, 0x80000000L, 0x00000000L), 4, HEXCONSTE(-8.000000e+00, 0xc002, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(-5.000000e-01, 0xbffe, 0x80000000L, 0x00000000L), 9, HEXCONSTE(-2.560000e+02, 0xc007, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(-5.000000e-01, 0xbffe, 0x80000000L, 0x00000000L), 16, HEXCONSTE(-3.276800e+04, 0xc00e, 0x80000000L, 0x00000000L), 0 },
	{ __LINE__, HEXCONSTE(6.172500e-01, 0x3ffe, 0x9e041893L, 0x74bc6a7fL), 1, HEXCONSTE(1.234500e+00, 0x3fff, 0x9e041893L, 0x74bc6a7fL), 0 },
	{ __LINE__, HEXCONSTE(7.185736e-01, 0x3ffe, 0xb7f4707fL, 0xc4dc3d83L), 34, HEXCONSTE(1.234500e+10, 0x4020, 0xb7f4707fL, 0xc4dc3d83), 0 },
	{ __LINE__, HEXCONSTE(5.855878e-01, 0x3ffe, 0x95e91501L, 0xefc4489aL), 69, HEXCONSTE(3.456700e+20, 0x4043, 0x95e91501L, 0xefc4489aL), 0 },
	{ __LINE__, HEXCONSTE(5.663457e-01, 0x3ffe, 0x90fc0823L, 0xbaf02b77L), -14, HEXCONSTE(3.456700e-05, 0x3ff0, 0x90fc0823L, 0xbaf02b77L), 0 },
	{ __LINE__, HEXCONSTE(-6.172500e-01, 0xbffe, 0x9e041893L, 0x74bc6a7fL), 1, HEXCONSTE(-1.234500e+00, 0xbfff, 0x9e041893L, 0x74bc6a7fL), 0 },
	{ __LINE__, HEXCONSTE(-7.185736e-01, 0xbffe, 0xb7f4707fL, 0xc4dc3d83L), 34, HEXCONSTE(-1.234500e+10, 0xc020, 0xb7f4707fL, 0xc4dc3d83L), 0 },
	{ __LINE__, HEXCONSTE(-5.855878e-01, 0xbffe, 0x95e91501L, 0xefc4489aL), 69, HEXCONSTE(-3.456700e+20, 0xc043, 0x95e91501L, 0xefc4489aL), FLAG_XFAIL }, /* slighly different */
	{ __LINE__, HEXCONSTE(-5.663457e-01, 0xbffe, 0x90fc0823L, 0xbaf02b77L), -14, HEXCONSTE(-3.456700e-05, 0xbff0, 0x90fc0823L, 0xbaf02b77L), FLAG_XFAIL }, /* slighly different */
	
	{ __LINE__, HEXCONSTE(0.8L, 0x3ffe, 0xccccccccL, 0xcccccccdL), 4, HEXCONSTE(12.8L, 0x4002, 0xccccccccL, 0xcccccccdL), NO_INEXACT_EXCEPTION },
	{ __LINE__, HEXCONSTE(-0.854375L, 0xbffe, 0xdab851ebL, 0x851eb852L), 5, HEXCONSTE(-27.34L, 0xc003, 0xdab851ebL, 0x851eb852L), NO_INEXACT_EXCEPTION },

	/* ldexp (x, 0) == x.  */
	{ __LINE__, HEXCONSTE(1.0L, 0x3fff, 0x80000000L, 0x00000000L), 0L, HEXCONSTE(1.0L, 0x3fff, 0x80000000L, 0x00000000L), NO_INEXACT_EXCEPTION },
};

int main(int argc, char **argv)
{
	int status;
	
	status = 0;
	
	test_init(argc, argv);
	
	status |= test_table_fi_f(ldexp_data, ARRAY_SIZE(ldexp_data), __FILE__);
	
	return status ? EXIT_FAILURE : EXIT_SUCCESS;
}
