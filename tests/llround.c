#include "testconfig.h"
#if defined(HAVE_LLROUND)
#define TEST_FUNC_F_LL __MATH_PRECNAME(llround)
#include "testdriver.h"



static test_f_ll_data const llround_data[] = {
	{ __LINE__, QNAN_P, LONG_LONG_MIN, 0 },
	{ __LINE__, QNAN_M, LONG_LONG_MIN, 0 },
	{ __LINE__, SNAN_P, LONG_LONG_MIN, 0 },
	{ __LINE__, SNAN_M, LONG_LONG_MIN, 0 },
	{ __LINE__, INF_P, LONG_LONG_MIN, 0 },
	{ __LINE__, INF_M, LONG_LONG_MIN, 0 },
	{ __LINE__, ZERO_P, 0, 0 },
	{ __LINE__, ZERO_M, 0, 0 },
	{ __LINE__, SUBNORM_P, 0, FLAG_SUBNORM },
	{ __LINE__, SUBNORM_M, 0, FLAG_SUBNORM },
	{ __LINE__, MIN_P, 0, 0 },
	{ __LINE__, MIN_M, 0, 0 },
	{ __LINE__, MAX_P, LONG_LONG_MIN, 0 },
	{ __LINE__, MAX_M, LONG_LONG_MIN, 0 },

	{ __LINE__, HEXCONSTE(0.2L, 0x3ffc, 0xccccccccL, 0xcccccccdL), 0, 0 },
	{ __LINE__, HEXCONSTE(-0.2L, 0xbffc, 0xccccccccL, 0xcccccccdL), 0, 0 },
	{ __LINE__, HEXCONSTE(0.5, 0x3ffe, 0x80000000L, 0x00000000L), 1, 0 },
	{ __LINE__, HEXCONSTE(-0.5, 0xbffe, 0x80000000L, 0x00000000L), -1, 0 },
	{ __LINE__, HEXCONSTE(0.8L, 0x3ffe, 0xccccccccL, 0xcccccccdL), 1, 0 },
	{ __LINE__, HEXCONSTE(-0.8L, 0xbffe, 0xccccccccL, 0xcccccccdL), -1, 0 },
	{ __LINE__, HEXCONSTE(1.5, 0x3fff, 0xc0000000L, 0x00000000L), 2, 0 },
	{ __LINE__, HEXCONSTE(-1.5, 0xbfff, 0xc0000000L, 0x00000000L), -2, 0 },
	{ __LINE__, HEXCONSTE(22514.5, 0x400d, 0xafe50000L, 0x00000000L), 22515LL, 0 },
	{ __LINE__, HEXCONSTE(-22514.5, 0xc00d, 0xafe50000L, 0x00000000L), -22515LL, 0 },
	{ __LINE__, HEXCONSTE(1071930.0008, 0x4013, 0x82d9d001L, 0xa36e2eb2L), 1071930LL, 0 },
#ifndef TEST_FLOAT
	{ __LINE__, HEXCONSTE(2097152.5, 0x4014, 0x80000200L, 0x00000000L), 2097153LL, 0 },
	{ __LINE__, HEXCONSTE(-2097152.5, 0xc014, 0x80000200L, 0x00000000L), -2097153LL, 0 },
	{ __LINE__, HEXCONSTE(34359738368.5, 0x4022, 0x80000000L, 0x08000000L), 34359738369ll, 0 },
	{ __LINE__, HEXCONSTE(-34359738368.5, 0xc022, 0x80000000L, 0x08000000L), -34359738369ll, 0 },
	{ __LINE__, HEXCONSTE(-3.65309740835E17, 0xc039, 0xa23ae8c2L, 0xeeb9d800L), -365309740835000000LL, 0 },
#endif

	/* Test boundary conditions.  */
	/* 0x1FFFFF */
	{ __LINE__, HEXCONSTE(2097151.0, 0x4013, 0xfffff800L, 0x00000000L), 2097151LL, 0 },
	/* 0x800000 */
	{ __LINE__, HEXCONSTE(8388608.0, 0x4016, 0x80000000L, 0x00000000L), 8388608LL, 0 },
	/* 0x1000000 */
	{ __LINE__, HEXCONSTE(16777216.0, 0x4017, 0x80000000L, 0x00000000L), 16777216LL, 0 },
	/* 0x20000000000 */
	{ __LINE__, HEXCONSTE(2199023255552.0, 0x4028, 0x80000000L, 0x00000000L), 2199023255552LL, 0 },
	/* 0x40000000000 */
	{ __LINE__, HEXCONSTE(4398046511104.0, 0x4029, 0x80000000L, 0x00000000L), 4398046511104LL, 0 },
	/* 0x1000000000000 */
	{ __LINE__, HEXCONSTE(281474976710656.0, 0x402f, 0x80000000L, 0x00000000L), 281474976710656LL, 0 },
	/* 0x10000000000000 */
	{ __LINE__, HEXCONSTE(4503599627370496.0, 0x4033, 0x80000000L, 0x00000000L), 4503599627370496LL, 0 },
	/* 0x10000080000000 */
	{ __LINE__, HEXCONSTE(4503601774854144.0, 0x4033, 0x80000400L, 0x00000000L), 4503601774854144LL, 0 },
	/* 0x20000000000000 */
	{ __LINE__, HEXCONSTE(9007199254740992.0, 0x4034, 0x80000000L, 0x00000000L), 9007199254740992LL, 0 },
	/* 0x80000000000000 */
	{ __LINE__, HEXCONSTE(36028797018963968.0, 0x4036, 0x80000000L, 0x00000000L), 36028797018963968LL, 0 },
	/* 0x100000000000000 */
	{ __LINE__, HEXCONSTE(72057594037927936.0, 0x4037, 0x80000000L, 0x00000000L), 72057594037927936LL, 0 },

#ifndef TEST_FLOAT
	/* 0x100000000 */
	{ __LINE__, HEXCONSTE(4294967295.5, 0x401e, 0xffffffffL, 0x80000000L), 4294967296LL, 0 },
	/* 0x200000000 */
	{ __LINE__, HEXCONSTE(8589934591.5, 0x401f, 0xffffffffL, 0xc0000000L), 8589934592LL, 0 },

	/* nextafter(0.5,-1)  */
	{ __LINE__, HEXCONSTE(4.99999999999999944489e-01, 0x3ffd, 0xffffffffL, 0xfffff800L), 0, 0 },
	/* nextafter(-0.5,1)  */
	{ __LINE__, HEXCONSTE(-4.99999999999999944489e-01, 0xbffd, 0xffffffffL, 0xfffff800L), 0, 0 },
	/* On PowerPC an exponent of '52' is the largest incrementally
	 * representable sequence of whole-numbers in the 'double' range.  We test
	 * lround to make sure that a guard bit set during the lround operation
	 * hasn't forced an erroneous shift giving us an incorrect result.	The odd
	 * numbers between +-(2^52+1 and 2^53-1) are affected since they have the
	 * rightmost bit set.  */
	/* +-(2^52+1)  */
	{ __LINE__, HEXCONSTE(4.50359962737049700000e+15, 0x4033, 0x80000000L, 0x00000800L), 4503599627370497LL, 0 },
	{ __LINE__, HEXCONSTE(-4.50359962737049700000e+15, 0xc033, 0x80000000L, 0x00000800L), -4503599627370497LL, 0 },
	/* +-(2^53-1): Input is the last (positive and negative) incrementally
	 * representable whole-number in the 'double' range that might round
	 * erroneously.  */
	{ __LINE__, HEXCONSTE(9.00719925474099100000e+15, 0x4033, 0xffffffffL, 0xfffff800L), 9007199254740991LL, 0 },
	{ __LINE__, HEXCONSTE(-9.00719925474099100000e+15, 0xc033, 0xffffffffL, 0xfffff800L), -9007199254740991LL, 0 },
#else
	/* nextafter(0.5,-1)  */
	{ __LINE__, HEXCONSTE(4.99999970197677612305e-01, 0x3ffd, 0xffffff00L, 0x00000000L), 0, 0 },
	/* nextafter(-0.5,1)  */
	{ __LINE__, HEXCONSTE(-4.99999970197677612305e-01, 0xbffd, 0xffffff00L, 0x00000000L), 0, 0 },
	/* As above, on PowerPC an exponent of '23' is the largest incrementally
	 * representable sequence of whole-numbers in the 'float' range.
	 * Likewise, numbers between +-(2^23+1 and 2^24-1) are affected.  */
	{ __LINE__, HEXCONSTE(8.38860900000000000000e+06, 0x4016, 0x80000100L, 0x00000000L), 8388609LL, 0 },
	{ __LINE__, HEXCONSTE(-8.38860900000000000000e+06, 0xc016, 0x80000100L, 0x00000000L), -8388609LL, 0 },
	{ __LINE__, HEXCONSTE(1.67772150000000000000e+07, 0x4016, 0xffffff00L, 0x00000000L), 16777215LL, 0 },
	{ __LINE__, HEXCONSTE(-1.67772150000000000000e+07, 0xc016, 0xffffff00L, 0x00000000L), -16777215LL, 0 },
#endif


#ifdef TEST_LDOUBLE
	/* The input can only be represented in long double.  */
	{ __LINE__, HEXCONSTE(4503599627370495.5L, 0x4032, 0xffffffffL, 0xfffff800L), 4503599627370496LL, 0 },
	{ __LINE__, HEXCONSTE(4503599627370496.25L, 0x4033, 0x80000000L, 0x00000200L), 4503599627370496LL, 0 },
	{ __LINE__, HEXCONSTE(4503599627370496.5L, 0x4033, 0x80000000L, 0x00000400L), 4503599627370497LL, 0 },
	{ __LINE__, HEXCONSTE(4503599627370496.75L, 0x4033, 0x80000000L, 0x00000600L), 4503599627370497LL, 0 },
	{ __LINE__, HEXCONSTE(4503599627370497.5L, 0x4033, 0x80000000L, 0x00000c00L), 4503599627370498LL, 0 },

# if LDBL_MANT_DIG > 100
	{ __LINE__, HEXCONSTE(4503599627370495.4999999999999L, 0x4032, 0xffffffffL, 0xfffff800L), 4503599627370495LL, 0 },
	{ __LINE__, HEXCONSTE(4503599627370496.4999999999999L, 0x4033, 0x80000000L, 0x00000400L), 4503599627370496LL, 0 },
	{ __LINE__, HEXCONSTE(4503599627370497.4999999999999L, 0x4033, 0x80000000L, 0x00000c00L), 4503599627370497LL, 0 },
	{ __LINE__, HEXCONSTE(4503599627370494.5000000000001L, 0x4032, 0xffffffffL, 0xffffe800L), 4503599627370495LL, 0 },
	{ __LINE__, HEXCONSTE(4503599627370495.5000000000001L, 0x4032, 0xffffffffL, 0xfffff800L), 4503599627370496LL, 0 },
	{ __LINE__, HEXCONSTE(4503599627370496.5000000000001L, 0x4033, 0x80000000L, 0x00000400L), 4503599627370497LL, 0 },

	{ __LINE__, HEXCONSTE(-4503599627370495.4999999999999L, 0xc032, 0xffffffffL, 0xfffff800L), -4503599627370495LL, 0 },
	{ __LINE__, HEXCONSTE(-4503599627370496.4999999999999L, 0xc033, 0x80000000L, 0x00000400L), -4503599627370496LL, 0 },
	{ __LINE__, HEXCONSTE(-4503599627370497.4999999999999L, 0xc033, 0x80000000L, 0x00000c00L), -4503599627370497LL, 0 },
	{ __LINE__, HEXCONSTE(-4503599627370494.5000000000001L, 0xc032, 0xffffffffL, 0xffffe800L), -4503599627370495LL, 0 },
	{ __LINE__, HEXCONSTE(-4503599627370495.5000000000001L, 0xc032, 0xffffffffL, 0xfffff800L), -4503599627370496LL, 0 },
	{ __LINE__, HEXCONSTE(-4503599627370496.5000000000001L, 0xc033, 0x80000000L, 0x00000400L), -4503599627370497LL, 0 },
# endif

	{ __LINE__, HEXCONSTE(-4503599627370495.5L, 0xc032, 0xffffffffL, 0xfffff800L), -4503599627370496LL, 0 },
	{ __LINE__, HEXCONSTE(-4503599627370496.25L, 0xc033, 0x80000000L, 0x00000200L), -4503599627370496LL, 0 },
	{ __LINE__, HEXCONSTE(-4503599627370496.5L, 0xc033, 0x80000000L, 0x00000400L), -4503599627370497LL, 0 },
	{ __LINE__, HEXCONSTE(-4503599627370496.75L, 0xc033, 0x80000000L, 0x00000600L), -4503599627370497LL, 0 },
	{ __LINE__, HEXCONSTE(-4503599627370497.5L, 0xc033, 0x80000000L, 0x00000c00L), -4503599627370498LL, 0 },

	{ __LINE__, HEXCONSTE(9007199254740991.5L, 0x4033, 0xffffffffL, 0xfffffc00L), 9007199254740992LL, 0 },
	{ __LINE__, HEXCONSTE(9007199254740992.25L, 0x4034, 0x80000000L, 0x00000100L), 9007199254740992LL, 0 },
	{ __LINE__, HEXCONSTE(9007199254740992.5L, 0x4034, 0x80000000L, 0x00000200L), 9007199254740993LL, 0 },
	{ __LINE__, HEXCONSTE(9007199254740992.75L, 0x4034, 0x80000000L, 0x00000300L), 9007199254740993LL, 0 },
	{ __LINE__, HEXCONSTE(9007199254740993.5L, 0x4034, 0x80000000L, 0x00000600L), 9007199254740994LL, 0 },

# if LDBL_MANT_DIG > 100
	{ __LINE__, HEXCONSTE(9007199254740991.4999999999999L, 0x4033, 0xffffffffL, 0xfffffc00L), 9007199254740991LL, 0 },
	{ __LINE__, HEXCONSTE(9007199254740992.4999999999999L, 0x4034, 0x80000000L, 0x00000200L), 9007199254740992LL, 0 },
	{ __LINE__, HEXCONSTE(9007199254740993.4999999999999L, 0x4034, 0x80000000L, 0x00000600L), 9007199254740993LL, 0 },
	{ __LINE__, HEXCONSTE(9007199254740991.5000000000001L, 0x4033, 0xffffffffL, 0xfffffc00L), 9007199254740992LL, 0 },
	{ __LINE__, HEXCONSTE(9007199254740992.5000000000001L, 0x4034, 0x80000000L, 0x00000200L), 9007199254740993LL, 0 },
	{ __LINE__, HEXCONSTE(9007199254740993.5000000000001L, 0x4034, 0x80000000L, 0x00000600L), 9007199254740994LL, 0 },

	{ __LINE__, HEXCONSTE(-9007199254740991.4999999999999L, 0xc033, 0xffffffffL, 0xfffffc00L), -9007199254740991LL, 0 },
	{ __LINE__, HEXCONSTE(-9007199254740992.4999999999999L, 0xc034, 0x80000000L, 0x00000200L), -9007199254740992LL, 0 },
	{ __LINE__, HEXCONSTE(-9007199254740993.4999999999999L, 0xc034, 0x80000000L, 0x00000600L), -9007199254740993LL, 0 },
	{ __LINE__, HEXCONSTE(-9007199254740991.5000000000001L, 0xc033, 0xffffffffL, 0xfffffc00L), -9007199254740992LL, 0 },
	{ __LINE__, HEXCONSTE(-9007199254740992.5000000000001L, 0xc034, 0x80000000L, 0x00000200L), -9007199254740993LL, 0 },
	{ __LINE__, HEXCONSTE(-9007199254740993.5000000000001L, 0xc034, 0x80000000L, 0x00000600L), -9007199254740994LL, 0 },
# endif

	{ __LINE__, HEXCONSTE(-9007199254740991.5L, 0xc033, 0xffffffffL, 0xfffffc00L), -9007199254740992LL, 0 },
	{ __LINE__, HEXCONSTE(-9007199254740992.25L, 0xc034, 0x80000000L, 0x00000100L), -9007199254740992LL, 0 },
	{ __LINE__, HEXCONSTE(-9007199254740992.5L, 0xc034, 0x80000000L, 0x00000200L), -9007199254740993LL, 0 },
	{ __LINE__, HEXCONSTE(-9007199254740992.75L, 0xc034, 0x80000000L, 0x00000300L), -9007199254740993LL, 0 },
	{ __LINE__, HEXCONSTE(-9007199254740993.5L, 0xc034, 0x80000000L, 0x00000600L), -9007199254740994LL, 0 },

	{ __LINE__, HEXCONSTE(72057594037927935.5L, 0x4036, 0xffffffffL, 0xffffff80L), 72057594037927936LL, 0 },
	{ __LINE__, HEXCONSTE(72057594037927936.25L, 0x4037, 0x80000000L, 0x00000020L), 72057594037927936LL, 0 },
	{ __LINE__, HEXCONSTE(72057594037927936.5L, 0x4037, 0x80000000L, 0x00000040L), 72057594037927937LL, 0 },
	{ __LINE__, HEXCONSTE(72057594037927936.75L, 0x4037, 0x80000000L, 0x00000060L), 72057594037927937LL, 0 },
	{ __LINE__, HEXCONSTE(72057594037927937.5L, 0x4037, 0x80000000L, 0x000000c0L), 72057594037927938LL, 0 },

	{ __LINE__, HEXCONSTE(-72057594037927935.5L, 0xc036, 0xffffffffL, 0xffffff80L), -72057594037927936LL, 0 },
	{ __LINE__, HEXCONSTE(-72057594037927936.25L, 0xc037, 0x80000000L, 0x00000020L), -72057594037927936LL, 0 },
	{ __LINE__, HEXCONSTE(-72057594037927936.5L, 0xc037, 0x80000000L, 0x00000040L), -72057594037927937LL, 0 },
	{ __LINE__, HEXCONSTE(-72057594037927936.75L, 0xc037, 0x80000000L, 0x00000060L), -72057594037927937LL, 0 },
	{ __LINE__, HEXCONSTE(-72057594037927937.5L, 0xc037, 0x80000000L, 0x000000c0L), -72057594037927938LL, 0 },

	{ __LINE__, HEXCONSTE(9223372036854775806.25L, 0x403d, 0xffffffffL, 0xfffffffcL), 9223372036854775806LL, 0 },
	{ __LINE__, HEXCONSTE(-9223372036854775806.25L, 0xc03d, 0xffffffffL, 0xfffffffcL), -9223372036854775806LL, 0 },
	{ __LINE__, HEXCONSTE(9223372036854775806.5L, 0x403d, 0xffffffffL, 0xfffffffdL), 9223372036854775807LL, 0 },
	{ __LINE__, HEXCONSTE(-9223372036854775806.5L, 0xc03d, 0xffffffffL, 0xfffffffdL), -9223372036854775807LL, 0 },
	{ __LINE__, HEXCONSTE(9223372036854775807.0L, 0x403d, 0xffffffffL, 0xfffffffeL), 9223372036854775807LL, 0 },
	{ __LINE__, HEXCONSTE(-9223372036854775807.0L, 0xc03d, 0xffffffffL, 0xfffffffeL), -9223372036854775807LL, 0 },
#endif
};


int main(int argc, char **argv)
{
	int status;
	
	status = 0;
	
	test_init(argc, argv);
	
	status |= test_table_f_ll(llround_data, ARRAY_SIZE(llround_data), __FILE__);
	(void)check_fp;

	return status ? EXIT_FAILURE : EXIT_SUCCESS;
}

#else

int main(void)
{
	return 77;
}

#endif
